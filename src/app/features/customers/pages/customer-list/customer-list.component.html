<div class="dashboard-container">
  <app-page-header
    title="Dashboard Clienti"
    subtitle="Gestione anagrafica e monitoraggio revenue"
  ></app-page-header>

  <main class="content-area">
    <div style="margin-bottom: 20px">
      <p-button
        label="Aggiungi Cliente"
        icon="pi pi-plus"
        (onClick)="openModal()"
      ></p-button>
    </div>

    <div *ngIf="customers$ | async as customers; else loading">
      <div class="card bg-white rounded-2xl shadow-lg overflow-hidden">
        <p-table
          [value]="customers"
          [tableStyle]="{ 'min-width': '50rem' }"
          [stripedRows]="true"
        >
          <ng-template pTemplate="header">
            <tr>
              <th>Nome</th>
              <th>Azienda</th>
              <th>Stato</th>
              <th>Fatturato</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-customer>
            <tr>
              <td>
                <div class="flex flex-col">
                  <strong
                    class="cursor-pointer text-primary hover:text-primary-600 underline"
                    [routerLink]="['/customers', customer.id]"
                    >{{ customer.name }}</strong
                  >
                  <small class="text-500">{{ customer.email }}</small>
                </div>
              </td>
              <td>{{ customer.company }}</td>
              <td>
                <app-status-tag [value]="customer.status"></app-status-tag>
              </td>
              <td class="font-bold">
                {{ customer.revenue | currency : "EUR" }}
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>

    <app-customer-modal
      [isOpen]="isModalOpen"
      (close)="closeModal()"
      (save)="saveCustomer($event)"
    ></app-customer-modal>

    <ng-template #loading>
      <div class="loading-state">
        <div class="spinner"></div>
        <p>Caricamento dati aziendali...</p>
      </div>
    </ng-template>
  </main>
</div>
